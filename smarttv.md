# Обход блокировки YouTube для любых Smart TV с ByeDPI Manager + V2ray + MaraDNS

Коротко: перенаправляем все DNS-запросы телевизора на DNS-сервер на вашем ПК, а там запускаем локальный прокси (v2ray) — он принимает подключения на 80/443, извлекает домен из TLS и проксирует трафик. Для обхода блокировок используем ByeDPI Manager. Подходит для любой модели телевизора (включая старые), но требует, чтобы компьютер был включён.

## Требования

- Windows-ПК в локальной сети (с правами администратора для открытия портов).
- Телевизор с возможностью вручную указать DNS (или возможность задать статический IP/DNS).
- ByeDPI Manager. [Инструкция](https://github.com/BDManual/ByeDPIManager-Manual/blob/main/install.md).
- Архив [v2ray-maradns.7z](https://github.com/BDManual/ByeDPIManager-Manual/blob/main/v2ray-maradns.7z) (распаковка даст папки v2ray и maradns).
- ProxiFyre — в ProxiFyre нужно указать путь к v2ray.exe.

## Быстрая схема работы

1. MaraDNS отвечает на любой DNS-запрос IP-адресом вашего компьютера.
2. ТВ подключается к этому IP на 80/443.
3. v2ray слушает 80/443, извлекает домен из TLS и проксирует трафик к реальному серверу.
4. ByeDPI Manager (работая на ПК) применяет обходы блокировок по необходимости.

## Установка и настройка (шаг за шагом)

> Выполняйте операции с правами администратора, когда потребуется.

1. Установите ByeDPI Manager
    - Следуйте официальной [инструкции](https://github.com/BDManual/ByeDPIManager-Manual/blob/main/install.md).
    - Убедитесь, что ByeDPI Manager запускается и работает на компьютере.

2. Распакуйте [v2ray-maradns.7z](https://github.com/BDManual/ByeDPIManager-Manual/blob/main/v2ray-maradns.7z)
    - В результате у вас должны появиться папки v2ray и maradns.

3. Добавьте v2ray в ProxiFyre
    - В ByeDPI Manager на вкладке ProxiFyre указать путь к v2ray.exe

4. Настройте файл зоны MaraDNS
    - Откройте файл `maradns/zone-redirect-all.txt` в блокноте.
    - Найдите все вхождения IP `192.168.69.128` и замените на IP-адрес вашего компьютера (тот, который виден в настройках сетевого адаптера или командой ipconfig).

> [!NOTE]
> Если ваш компьютер использует DHCP и IP может менять, лучше закрепить IP в настройках роутера (статический DHCP lease).

5. Запустите v2ray
    - Запустите `v2ray\v2ray-run.cmd`. При первом запуске разрешите сетевое взаимодействие в брандмауэре. Окно можно свернуть.

6. Запустите MaraDNS
    - Запустите `maradns\mara-run.cmd`. Тоже разрешите в брандмауэре и сверните окно.

7. Настройте телевизор (DNS)
    - В настройках сети телевизора найдите поля DNS-сервера.
    - Укажите IP-адрес вашего компьютера (тот, который вы прописали в `zone-redirect-all.txt`) в качестве основного DNS (и в качестве альтернативного, если требуется два адреса).
    - Если телевизор требует ручной настройки IP, маски и шлюза — задайте корректные значения из вашей сети (или используйте статический IP в той же подсети).
    - Отключите IPv6 на телевизоре, если есть такая опция (см. раздел «Проблемы» ниже).

8. Проверка
    - Откройте браузер на ТВ — сайты должны открываться.
    - Откройте YouTube — он должен работать (при условии, что он использует 80/443 и обычные DNS-A/AAAA записи).

## Примеры полезных команд (Windows)

Открытие портов в брандмауэре (выполнить в командной строке от имени администратора):

```PowerShell
netsh advfirewall firewall add rule name="Allow DNS (UDP 53)" dir=in action=allow protocol=UDP localport=53
netsh advfirewall firewall add rule name="Allow HTTP (TCP 80)" dir=in action=allow protocol=TCP localport=80
netsh advfirewall firewall add rule name="Allow HTTPS (TCP 443)" dir=in action=allow protocol=TCP localport=443
```

Проверить IP ПК:

```PowerShell
ipconfig
```

## Настройки v2ray (особенности)

В конфигурации (например, `v2ray\youtube.json`) по умолчанию разрешён доступ только с локальных диапазонов:

```bash
192.168.0.0/16, 172.16.0.0/12, 10.0.0.0/8
```

Если у вас другая адресация — откройте `youtube.json` и в секции routing добавьте/измените диапазоны под вашу сеть.

## Решение типичных проблем

1. Телевизор игнорирует IPv4 DNS и всё равно не работает
    - Многие роутеры/устройства раздают DNS по IPv6 — и IPv6 имеет приоритет. Отключите IPv6 в настройках телевизора или в роутере (отключите выдачу DNS по IPv6 или IPv6 полностью).

2. MaraDNS сообщает, что порт 53 занят
    - Проверьте, не запущена ли служба **Host Network Service** (hns) или другой DNS-сервер. Остановите конфликтующую службу.

3. Windows Firewall блокирует входящие
    - Установите тип сети для вашего сетевого подключения в Windows как Private и добавьте правила для портов 53/80/443 (см. команды выше) либо разрешите приложениям v2ray и maradns сетевое взаимодействие.

4. Вчера всё работало, сегодня — нет
    - Проверьте IP компьютера: возможно, он изменился. Обновите `maradns/zone-redirect-all.txt` и перенастройте DNS на телевизоре. Для стабильности закрепите IP в роутере.

5. Если телевизор в другой подсети
    - Убедитесь, что роутер и ПК/ТВ находятся в одной подсети или есть маршрутизация между ними. В противном случае DNS-перенаправление не сработает.

## Как это работает (технически)

1. MaraDNS отвечает на любой DNS-запрос IP вашего ПК (все домены → ваш компьютер).
2. Телевизор направляет запросы к этому IP на порты 80/443.
3. v2ray принимает соединение, извлекает из TLS-handshake реальный домен (SNI) и устанавливает обычный исходящий подключение к этому домену.
4. ByeDPI Manager (работая на ПК) детектирует заблокованные домены/пакеты и применяет методы модификации трафика, чтобы соединение прошло через блокировку.

> Ограничения: способ работает, если целевые ресурсы используют порты 80/443 и не полагаются на специфические DNS-записи (например, некоторые сервисы используют SRV/CAA/специфичные AAAA записи и пр.). В большинстве случаев этого достаточно (включая YouTube).

## Примечания

1. Изначальная [инструкция](https://ntc.party/t/%D0%BE%D0%B1%D1%85%D0%BE%D0%B4-%D0%B1%D0%BB%D0%BE%D0%BA%D0%B8%D1%80%D0%BE%D0%B2%D0%BA%D0%B8-youtube-%D0%B4%D0%BB%D1%8F-%D0%BB%D1%8E%D0%B1%D1%8B%D1%85-smart-tv-%D1%81-goodbyedpi-v2ray-maradns/9415) от ValdikSS для GoodbyeDPI.
2. [Обсуждение](https://ntc.party/t/byedpimanager-%D0%B4%D0%BB%D1%8F-smart-tv-lg-webos/18605) работы связки ByeDPI Manager + V2ray + MaraDNS
